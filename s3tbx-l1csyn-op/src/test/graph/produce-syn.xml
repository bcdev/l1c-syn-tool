<!--
 Copyright (C) 2020 Brockmann Consult GmbH (info@brockmann-consult.de)

 This program is free software; you can redistribute it and/or modify it
 under the terms of the GNU General Public License as published by the Free
 Software Foundation; either version 3 of the License, or (at your option)
 any later version.
 This program is distributed in the hope that it will be useful, but WITHOUT
 ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
 more details.

 You should have received a copy of the GNU General Public License along
 with this program; if not, see http://www.gnu.org/licenses/
 -->

<graph id="produce-syn">
    <version>1.0</version>
    <!--
     Read a Sentinel-3 OLCI L1b product.
     -->
    <node id="ReadOlc">
        <operator>Read</operator>
        <sources/>
        <parameters>
            <file>${olcFile}/xfdumanifest.xml</file>
            <formatName>Sen3</formatName>
        </parameters>
    </node>

    <!--
     Read a Sentinel-3 SLSTR L1b product.
     -->
    <node id="ReadSls">
        <operator>Read</operator>
        <sources/>
        <parameters>
            <file>${slsFile}/xfdumanifest.xml</file>
            <formatName>Sen3</formatName>
        </parameters>
    </node>

    <!--
     Make the SYN product.
     -->
    <node id="MakeSyn">
        <operator>L1CSYN</operator>
        <sources>
            <olciProduct refid="ReadOlc"/>
            <slstrProduct refid="ReadSls"/>
        </sources>
        <parameters>
            <stayOnOlciGrid>true</stayOnOlciGrid>
            <reprojectionCRS>EPSG:4326</reprojectionCRS>
            <upsampling>Nearest</upsampling>
            <useMISR>true</useMISR>
            <misrFile>${misFile}/xfdumanifest.xml</misrFile>
            <geoRegion>${polygon}</geoRegion>
        </parameters>
    </node>

    <node id="Write">
        <operator>Write</operator>
        <sources>
            <sourceProduct refid="MakeSyn"/>
        </sources>
        <parameters>
            <file>${targetFile}</file>
            <formatName>BEAM-DIMAP</formatName>
        </parameters>
    </node>
</graph>
